---
title: "transtataR"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

StataユーザーのためのRパッケージです。

- 作成者：[土井翔平](https://shohei-doi.github.io/)
- 連絡先：[shohei.doi0504@gmail.com](shohei.doi0504@gmail.com)

趣味の範囲内なので、それをご理解の上、ご利用して下さい。
開発者はStataユーザーではないので、バグや要望を報告していただけると幸いです。

## インストール

`{devtools}`などを使ってGitHubからインストールをしてください。

```{r, eval=FALSE}
devtools::install_github("shohei-doi/transtataR")
```

- `{devtools}`をインストールしていない人は、まずこちらからインストールしてください。

```{r, eval=FALSE}
install.packages("devtools")
```

## 基本的な使い方

まずはパッケージを読み込みます。

```{r}
library(transtataR)
```

`stata2r()`という関数にStataのコードを入れて実行できます。
現在、対応しているStataのコマンドは以下の通りです。

- `pwd`
- `cd`
- `use`
- `save`
- `insheet using`
- `import excel`
- `browse`
- `list`
- `sum`
- `rename`
- `keep`
- `drop`
- `gen`
- `replace`
- `reg`
- `logit`
- `probit`

### 具体例

例として[Tableau Public](https://public.tableau.com/s/resources)のSample Dataから[Titanic Passenger List](https://public.tableau.com/s/sites/default/files/media/titanic%20passenger%20list.csv)をダウンロードして、適当な場所に保存をします。

#### データの読み込み

このようにしてStataのコマンド`use`でデータを読み込むことができます。

```{r}
stata2r("insheet using 'data/titanic passenger list.csv'")
```

- 文字列はシングルクオート`'`で囲んでください。

#### データの閲覧

生データを見ます。

```{r, eval=FALSE}
stata2r("browse")
stata2r("browse if age > 20")
stata2r("browse sex age")
```

生データの一部を見ます。

```{r}
stata2r("list if age > 20")
stata2r("list sex age")
```

#### 記述統計

記述統計を見ます。

```{r}
stata2r("sum")
```

#### 変数の作成、加工

変数を作ります（試しに、18歳以下の女性を表す`fchild`を作ります）。

```{r}
stata2r("gen fchild = 0")
stata2r("replace fchild = 1 if age <= 18 & sex == 'female'")
```

#### 回帰分析

回帰分析を行います。

```{r}
stata2r("reg survived c.sex age")
stata2r("reg survived c.sex#age")
stata2r("logit survived c.sex age if age > 20")
stata2r("probit survived c.sex age if age <= 20")
```

## 発展的な使い方

### 複数行の実行

`stata2r()`には複数のStataコードを入力することができます。

```{r}
stata2r(
  "insheet using 'data/titanic passenger list.csv'",
  "list age sex",
  "reg survived c.sex age"
)
```

### Rコードの表示

オプション`show.code`を`TRUE`にするとコマンドを実行する代わりにRコードとパッケージを表示します。

```{r}
stata2r("reg survived c.sex#age", show.code = TRUE)
```

```{r}
stata2r(
  "insheet using 'data/titanic passenger list.csv'",
  "list age sex",
  "reg survived c.sex age",
  show.code = TRUE
)
```

### doファイルの変換

関数`transtataR()`はdoファイルのパスを引数に取り、Rコードに翻訳します。
例えば、[サンプルdoファイル](code/sample.do)を[Rコード](code/sample.R)にしてみます。

```{r}
transtataR("code/sample.do")
```

- `path`を特定しない場合、doファイルと同じディレクトリに同じ名前で保存します。

`execute`を`TRUE`にするとコードを変換する代わりに実行します。

```{r}
transtataR("code/sample.do", execute = TRUE)
```

## 開発環境

```{r}
sessionInfo()
```
