---
title: "transtataR"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

StataユーザーのためのRパッケージです。

- 作成者：[土井翔平](https://shohei-doi.github.io/)
- 連絡先：[shohei.doi0504@gmail.com](shohei.doi0504@gmail.com)

開発者はStataユーザーではないので、バグや要望を報告していただけると幸いです。

## インストール

`{devtools}`などを使ってGitHubからインストールをしてください。

```{r, eval=FALSE}
devtools::install_github("shohei-doi/transtataR")
```

- `{devtools}`をインストールしていない人は、まずこちらからインストールしてください。

```{r, eval=FALSE}
install.packages("devtools")
```

## 基本的な使い方

まずはパッケージを読み込みます。

```{r}
library(transtataR)
```

`stata2r()`という関数にStataのコードを入れて実行できます。
現在、対応しているStataのコマンドは以下の通りです。

- `pwd`
- `cd`
- `use`
- `save`
- `insheet using`
- `import excel`
- `browse`
- `sum`
- `rename`
- `keep`
- `drop`
- `gen`
- `replace`
- `reg`
- `logit`
- `probit`

### 具体例

例として[Tableau Public](https://public.tableau.com/s/resources)のSample Dataから[Titanic Passenger List](https://public.tableau.com/s/sites/default/files/media/titanic%20passenger%20list.csv)をダウンロードして、適当な場所に保存をします。

このようにしてStataのコマンド`use`でデータを読み込むことができます。

```{r}
stata2r("insheet using 'data/titanic passenger list.csv'")
```

- 文字列はシングルクオート`'`で囲んでください。

生データを見ます。

```{r, eval=FALSE}
stata2r("browse")
stata2r("browse if age > 20")
stata2r("browse sex age")
```

生データの一部を見ます。

```{r}
stata2r("list if age > 20")
stata2r("list sex age")
```


記述統計を見ます。

```{r}
stata2r("sum")
```

変数を作ります（試しに、18歳以下の女性を表す`fchild`を作ります）。

```{r}
stata2r("gen fchild = 0")
stata2r("replace fchild = 1 if age <= 18 & sex == 'female'")
```

回帰分析を行います。

```{r}
stata2r("reg survived c.sex age")
stata2r("reg survived c.sex#age")
stata2r("logit survived c.sex age if age > 20")
stata2r("probit survived c.sex age if age <= 20")
```

## 発展的な使い方

### 内部の処理

`stata2r()`はStataのコマンドをRコードに変換して実行をしていますが、実はStataコマンドと同じ名前（に`_`を付けたもの）の関数を定義しています。
例えば、回帰分析を行う際には`reg_()`を内部で呼び出しています。
なので、明示的に`reg_()`を呼び出すことも可能です。

```{r}
reg_("survived sex age")
```

## 動作環境

```{r}
sessionInfo()
```
